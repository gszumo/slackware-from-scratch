#!/bin/bash

execute_sed_llvm () {
#******************************************************************
# change "clang++" to "g++" and "clang" to "gcc" in SlackBuild
#******************************************************************
if [ ! -f llvm.SlackBuild.old ]; then
	cp -v llvm.SlackBuild llvm.SlackBuild.old
	(
		cd "$SLACKSRC"/d/llvm || exit 1
		# shellcheck disable=SC2016
		sed -i -e 's/"clang++"/"g++"/' llvm.SlackBuild
		sed -i -e 's/"clang"/"gcc"/' llvm.SlackBuild
		sed -i -e "s/-GNinja/-Wno-dev -GNinja/" llvm.SlackBuild
		sed -i -e "s/-DBUILD_SHARED_LIBS=ON/-DLLVM_BUILD_LLVM_DYLIB=ON/" llvm.SlackBuild
		sed -i -e "s/-DLLVM_USE_LINKER=gold/-DLLVM_LINK_LLVM_DYLIB=ON/" llvm.SlackBuild
		sed -i -e "/-DLLVM_ENABLE_RTTI=ON/d" llvm.SlackBuild
		sed -i -e "/-DLLVM_ENABLE_ASSERTIONS=OFF/d" llvm.SlackBuild
		sed -i -e "/-DLLVM_INSTALL_UTILS=ON/d" llvm.SlackBuild
	)
fi
}
execute_sed_llvm
